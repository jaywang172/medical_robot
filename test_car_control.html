<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš— æ¨¹è“æ´¾è»Šè¼›æ§åˆ¶æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
            max-width: 300px;
            margin: 20px auto;
        }
        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .control-btn:active {
            transform: translateY(0);
        }
        .emergency-btn {
            background: rgba(220, 53, 69, 0.8) !important;
            grid-column: span 3;
            font-weight: bold;
        }
        .stop-btn {
            background: rgba(108, 117, 125, 0.8) !important;
        }
        .status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            min-height: 50px;
        }
        .success {
            background: rgba(40, 167, 69, 0.3);
            border-left: 4px solid #28a745;
        }
        .error {
            background: rgba(220, 53, 69, 0.3);
            border-left: 4px solid #dc3545;
        }
        .info {
            background: rgba(23, 162, 184, 0.3);
            border-left: 4px solid #17a2b8;
        }
        .duration-control {
            text-align: center;
            margin: 20px 0;
        }
        .duration-slider {
            width: 200px;
            margin: 10px;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .ip-display {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
        }
        .quick-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .quick-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quick-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— æ¨¹è“æ´¾è»Šè¼›æ§åˆ¶ä¸­å¿ƒ</h1>
        
        <div class="ip-display">
            ğŸ“ é€£æ¥åˆ°æ¨¹è“æ´¾: <strong>192.168.0.167:8000</strong>
        </div>
        
        <div id="status" class="status info">
            ğŸ” æº–å‚™æ¸¬è©¦é€£æ¥...
        </div>
        
        <div class="quick-actions">
            <button class="quick-btn" onclick="testConnection()">ğŸ”— æ¸¬è©¦é€£æ¥</button>
            <button class="quick-btn" onclick="getCarStatus()">ğŸ“Š ç²å–ç‹€æ…‹</button>
            <button class="quick-btn" onclick="resetEmergency()">ğŸ”„ é‡ç½®ç·Šæ€¥åœæ­¢</button>
        </div>
        
        <div class="duration-control">
            <label for="duration">ğŸ• å‹•ä½œæŒçºŒæ™‚é–“: <span id="durationValue">0.5</span> ç§’</label><br>
            <input type="range" id="duration" class="duration-slider" min="0.1" max="3.0" step="0.1" value="0.5" 
                   onchange="updateDuration(this.value)">
        </div>
        
        <div class="control-grid">
            <!-- ç©ºä½ -->
            <div></div>
            <!-- å‰é€² -->
            <button class="control-btn" onclick="carControl('forward')">â¬†ï¸</button>
            <!-- ç©ºä½ -->
            <div></div>
            
            <!-- å·¦è½‰ -->
            <button class="control-btn" onclick="carControl('turn_left')">â¬…ï¸</button>
            <!-- åœæ­¢ -->
            <button class="control-btn stop-btn" onclick="carControl('stop')">â¹ï¸</button>
            <!-- å³è½‰ -->
            <button class="control-btn" onclick="carControl('turn_right')">â¡ï¸</button>
            
            <!-- ç©ºä½ -->
            <div></div>
            <!-- å¾Œé€€ -->
            <button class="control-btn" onclick="carControl('backward')">â¬‡ï¸</button>
            <!-- ç©ºä½ -->
            <div></div>
            
            <!-- ç·Šæ€¥åœæ­¢ -->
            <button class="control-btn emergency-btn" onclick="emergencyStop()">ğŸš¨ ç·Šæ€¥åœæ­¢</button>
        </div>
        
        <div style="text-align: center; margin-top: 30px; font-size: 14px; opacity: 0.8;">
            <p>ğŸ’¡ ä½¿ç”¨æ–¹å‘éµæ§åˆ¶è»Šè¼›ç§»å‹•</p>
            <p>âš ï¸ è«‹ç¢ºä¿è»Šè¼›åœ¨å®‰å…¨ç’°å¢ƒä¸­æ“ä½œ</p>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://192.168.0.167:8000';
        let currentDuration = 0.5;
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }
        
        function updateDuration(value) {
            currentDuration = parseFloat(value);
            document.getElementById('durationValue').textContent = value;
        }
        
        async function testConnection() {
            showStatus('ğŸ” æ­£åœ¨æ¸¬è©¦é€£æ¥...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/`);
                
                if (response.ok) {
                    const data = await response.json();
                    showStatus(`âœ… é€£æ¥æˆåŠŸï¼<br>
                               ğŸ“¡ æœå‹™å™¨: ${data.message || 'æ¨¹è“æ´¾æ©Ÿå™¨äººæ§åˆ¶API'}<br>
                               ğŸ”§ ç‹€æ…‹: ${data.status || 'é‹è¡Œä¸­'}<br>
                               ğŸ’» æ¨¡å¼: ${data.mode || 'æœªçŸ¥'}`, 'success');
                } else {
                    showStatus(`âŒ é€£æ¥å¤±æ•—: HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ é€£æ¥éŒ¯èª¤: ${error.message}<br>
                           è«‹æª¢æŸ¥ï¼š<br>
                           1. æ¨¹è“æ´¾æ˜¯å¦é–‹æ©Ÿä¸¦é‹è¡Œæœå‹™å™¨<br>
                           2. IPåœ°å€ 192.168.0.167 æ˜¯å¦æ­£ç¢º<br>
                           3. ç«¯å£ 8000 æ˜¯å¦é–‹æ”¾`, 'error');
            }
        }
        
        async function getCarStatus() {
            showStatus('ğŸ“Š æ­£åœ¨ç²å–è»Šè¼›ç‹€æ…‹...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/car/status`);
                
                if (response.ok) {
                    const data = await response.json();
                    showStatus(`âœ… è»Šè¼›ç‹€æ…‹ï¼š<br>
                               ğŸš— é‹å‹•ç‹€æ…‹: ${data.is_moving ? 'ğŸŸ¢ é‹å‹•ä¸­' : 'âšª éœæ­¢'}<br>
                               ğŸ§­ ç•¶å‰æ–¹å‘: ${getDirectionIcon(data.current_direction)} ${data.current_direction}<br>
                               ğŸš¨ ç·Šæ€¥åœæ­¢: ${data.emergency_stop ? 'ğŸ”´ å•Ÿå‹•' : 'ğŸŸ¢ æ­£å¸¸'}<br>
                               ğŸ’» é‹è¡Œæ¨¡å¼: ${data.simulation_mode ? 'ğŸ–¥ï¸ æ¨¡æ“¬' : 'ğŸ”§ ç¡¬ä»¶'}<br>
                               â° æœ€å¾Œå‘½ä»¤: ${new Date(data.last_command_time * 1000).toLocaleTimeString()}`, 'success');
                } else {
                    showStatus(`âŒ ç‹€æ…‹ç²å–å¤±æ•—: HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ ç‹€æ…‹ç²å–éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        function getDirectionIcon(direction) {
            const icons = {
                'forward': 'â¬†ï¸',
                'backward': 'â¬‡ï¸',
                'turn_left': 'â¬…ï¸',
                'turn_right': 'â¡ï¸',
                'left': 'â¬…ï¸',
                'right': 'â¡ï¸',
                'stop': 'â¹ï¸'
            };
            return icons[direction] || 'â“';
        }
        
        async function carControl(action) {
            const actionNames = {
                'forward': 'å‰é€²',
                'backward': 'å¾Œé€€',
                'turn_left': 'å·¦è½‰',
                'turn_right': 'å³è½‰',
                'stop': 'åœæ­¢'
            };
            
            const actionName = actionNames[action] || action;
            showStatus(`ğŸ® æ­£åœ¨åŸ·è¡Œ: ${getDirectionIcon(action)} ${actionName} (${currentDuration}ç§’)...`, 'info');
            
            try {
                const url = `${API_BASE_URL}/api/car/control?action=${action}&duration=${currentDuration}`;
                const response = await fetch(url, { method: 'POST' });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showStatus(`âœ… ${actionName} åŸ·è¡ŒæˆåŠŸï¼<br>ğŸ“ ${data.message}`, 'success');
                        // è‡ªå‹•æ›´æ–°ç‹€æ…‹
                        setTimeout(getCarStatus, 500);
                    } else {
                        showStatus(`âŒ ${actionName} åŸ·è¡Œå¤±æ•—: ${data.message}`, 'error');
                    }
                } else {
                    showStatus(`âŒ æ§åˆ¶è«‹æ±‚å¤±æ•—: HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ æ§åˆ¶éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        async function emergencyStop() {
            showStatus('ğŸš¨ æ­£åœ¨åŸ·è¡Œç·Šæ€¥åœæ­¢...', 'error');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/car/control?action=emergency_stop`, { 
                    method: 'POST' 
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showStatus('ğŸš¨ ç·Šæ€¥åœæ­¢å·²åŸ·è¡Œï¼è»Šè¼›å·²å®‰å…¨åœæ­¢ã€‚', 'error');
                        setTimeout(getCarStatus, 500);
                    } else {
                        showStatus(`âŒ ç·Šæ€¥åœæ­¢å¤±æ•—: ${data.message}`, 'error');
                    }
                } else {
                    showStatus(`âŒ ç·Šæ€¥åœæ­¢è«‹æ±‚å¤±æ•—: HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ ç·Šæ€¥åœæ­¢éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        async function resetEmergency() {
            showStatus('ğŸ”„ æ­£åœ¨é‡ç½®ç·Šæ€¥åœæ­¢ç‹€æ…‹...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/car/emergency_reset`, { 
                    method: 'POST' 
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showStatus('âœ… ç·Šæ€¥åœæ­¢å·²é‡ç½®ï¼Œè»Šè¼›å¯ä»¥æ­£å¸¸æ“ä½œã€‚', 'success');
                        setTimeout(getCarStatus, 500);
                    } else {
                        showStatus(`âŒ é‡ç½®å¤±æ•—: ${data.message}`, 'error');
                    }
                } else {
                    showStatus(`âŒ é‡ç½®è«‹æ±‚å¤±æ•—: HTTP ${response.status}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ é‡ç½®éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        // éµç›¤æ§åˆ¶
        document.addEventListener('keydown', function(event) {
            if (event.target.tagName.toLowerCase() === 'input') return; // å¿½ç•¥è¼¸å…¥æ¡†
            
            switch(event.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    event.preventDefault();
                    carControl('forward');
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    event.preventDefault();
                    carControl('backward');
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    event.preventDefault();
                    carControl('turn_left');
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    event.preventDefault();
                    carControl('turn_right');
                    break;
                case ' ': // ç©ºæ ¼éµåœæ­¢
                    event.preventDefault();
                    carControl('stop');
                    break;
                case 'Escape': // ESC ç·Šæ€¥åœæ­¢
                    event.preventDefault();
                    emergencyStop();
                    break;
            }
        });
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦é€£æ¥
        window.onload = function() {
            showStatus('ğŸ” æ­£åœ¨è‡ªå‹•æ¸¬è©¦é€£æ¥...', 'info');
            setTimeout(testConnection, 1000);
        };
        
        // å®šæœŸæ›´æ–°ç‹€æ…‹ (æ¯3ç§’)
        setInterval(() => {
            if (document.getElementById('status').className.includes('success')) {
                getCarStatus();
            }
        }, 3000);
    </script>
</body>
</html>
